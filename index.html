<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>DIZ FLYZE NGERJAIN TUGAS DENGAN AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v4.0.2/dist/tesseract.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow-x:hidden;font-family:'Poppins',sans-serif;background-color:#000}
    a{text-decoration:none;color:inherit}
    #bgCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1}
    #loadingOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;z-index:4000}
    .spinner{width:60px;height:60px;position:relative;transform-style:preserve-3d;animation:spin 2s infinite linear}
    .spinner:before,.spinner:after{content:'';position:absolute;top:0;left:0;width:60px;height:60px;border:4px solid #fff;border-radius:50%;box-sizing:border-box}
    .spinner:before{border-color:#ff007f;animation:spinReverse 2s infinite linear}
    .spinner:after{border-color:#6a0dad;animation:spin 2s infinite linear}
    @keyframes spin{from{transform:rotate3d(1,1,0,0deg)}to{transform:rotate3d(1,1,0,360deg)}}
    @keyframes spinReverse{from{transform:rotate3d(1,1,0,360deg)}to{transform:rotate3d(1,1,0,0deg)}}
    .app-container{position:relative;height:100vh}
    .app-header{position:fixed;top:0;left:0;right:0;height:60px;animation:auroraHeader 6s infinite alternate;box-shadow:0 2px 4px rgba(0,0,0,0.3);z-index:1000}
    .top-bar{display:flex;align-items:center;justify-content:center;padding:15px 25px}
    .top-bar h1{color:#fff;font-size:20px}
    @keyframes auroraHeader{
      0%{background:linear-gradient(135deg, #075E54, #0a3d2c, #000)}
      50%{background:linear-gradient(135deg, #000, #0a3d2c, #075E54)}
      100%{background:linear-gradient(135deg, #075E54, #0a3d2c, #000)}
    }
    .chat-container{position:absolute;top:60px;bottom:60px;left:0;right:0}
    .chat-body{height:100%;padding:15px;overflow-y:auto;background:url('https://i.ibb.co/Qjj4tcqd/2d03d93b7bc9.jpg') center center/cover no-repeat;display:flex;flex-direction:column;gap:10px}
    .chat-footer{position:fixed;bottom:0;left:0;right:0;height:60px;display:flex;align-items:center;gap:10px;background-color:#ECE5DD;padding:15px;z-index:1000}
    .chat-footer textarea{flex:1;padding:10px;border:none;border-radius:6px;resize:none;font-family:inherit;font-size:16px;height:45px}
    .chat-footer button{background:transparent;border:none;cursor:pointer;padding:8px}
    .chat-message{padding:12px 18px;border-radius:8px;max-width:80%;font-size:16px;line-height:1.4;word-wrap:break-word}
    .chat-message.assistant{background:#fff;color:#000;align-self:flex-start;animation:slideIn 0.5s ease}
    .chat-message.user{background:#DCF8C6;color:#000;align-self:flex-end;animation:slideIn 0.5s ease}
    @keyframes slideIn{from{transform:translateX(20px);opacity:0}to{transform:translateX(0);opacity:1}}
    .code-block{position:relative;margin:10px 0}
    .copy-btn{position:absolute;top:5px;right:5px;padding:5px 10px;background:#444;color:#fff;border:none;border-radius:4px;cursor:pointer}
    pre{background:#2d2d2d;padding:10px;border-radius:6px;overflow-x:auto}
    .chat-message pre{max-height:300px;overflow-y:auto;white-space:pre-wrap;word-wrap:break-word}
    #uploadModal{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;padding:20px;border-radius:8px;z-index:3500;width:280px;color:#fff}
    #uploadModalHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    #closeUploadModal{background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer}
    .upload-option{display:flex;align-items:center;gap:10px;margin:8px 0;padding:10px;background:#444;border-radius:4px;cursor:pointer}
    .upload-option svg{width:24px;height:24px;fill:#fff}
    .upload-option:hover{background:#555}
  </style>
</head>
<body>
  <div id="loadingOverlay">
    <div class="spinner"></div>
  </div>
  <canvas id="bgCanvas"></canvas>
  <div class="app-container">
    <header class="app-header">
      <div class="top-bar">
        <h1>㋛︎ 𝐃𝐈𝐙 𝐅𝐋𝐘𝐙𝐄 𝐀𝐈 ㋛︎</h1>
      </div>
    </header>
    <div class="chat-container">
      <div class="chat-body" id="chatBody"></div>
    </div>
    <div class="chat-footer">
      <button id="chatPlusBtn" title="Unggah">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#000">
          <path d="M12 5v14m-7-7h14" stroke="#000" stroke-width="2" fill="none" stroke-linecap="round"/>
        </svg>
      </button>
      <textarea id="chatInput" placeholder="Ketik pesan..."></textarea>
      <button id="chatSendBtn" title="Kirim">
        <svg class="icon" viewBox="0 0 24 24" width="24" height="24" fill="#000">
          <path d="M22 2L11 13" stroke="#000" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M22 2L15 22L11 13L2 9l20-7z" stroke="#000" stroke-width="2" fill="none" stroke-linecap="round"/>
        </svg>
      </button>
      <input type="file" id="chatFileInput" accept="image/*" style="display:none">
      <input type="file" id="restoreFileInput" accept="application/json" style="display:none">
      <input type="file" id="chatFileTextInput" accept=".txt,.json" style="display:none">
    </div>
  </div>
  <div id="uploadModal">
    <div id="uploadModalHeader">
      <h3>Diz Flyze Fitur</h3>
      <button id="closeUploadModal">&times;</button>
    </div>
    <div class="upload-option" id="uploadImageBtn">
      <svg viewBox="0 0 24 24">
        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8 13l2.03 2.71L13 11l4 5H6l2-3z"/>
      </svg>
      <span>Upload Gambar</span>
    </div>
    <div class="upload-option" id="uploadFileBtn">
      <svg viewBox="0 0 24 24">
        <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 14H8v-2h8v2zm0-4H8v-2h8v2z"/>
      </svg>
      <span>Upload Filemu</span>
    </div>
  </div>
  <script>
    (function(){
      "use strict";
      const apiKeys=["98c88ca7467b4eb6bc0df13c16cabd7b","a92e386f50114a96b8891417a09bdd61","b1869d6815e2439e8dd52ad0581ca638","00f906d273414bab800c77ea10994974","c806ec9809a14ab2967c4c5dd3f91919"];
      let currentKeyIndex=0;
      const getCurrentApiKey=()=>apiKeys[currentKeyIndex];
      const rotateApiKey=()=>{currentKeyIndex=(currentKeyIndex+1)%apiKeys.length};
      let chatHistory=[];
      const formatMessage=message=>{
        let formatted=message.replace(/\n/g,"<br>");
        formatted=formatted.replace(/```([\s\S]*?)```/g,(match,codeContent)=>{
          let codeId="code-"+Math.random().toString(36).substr(2,9);
          return `<div class="code-block"><button class="copy-btn" onclick="copyCode('${codeId}')">Copy</button><pre><code id="${codeId}">${codeContent}</code></pre></div>`;
        });
        return formatted;
      };
      window.copyCode=codeId=>{
        const codeElem=document.getElementById(codeId);
        if(!codeElem)return;
        navigator.clipboard.writeText(codeElem.innerText).then(()=>alert("Kode berhasil disalin!")).catch(err=>console.error("Gagal menyalin kode:",err));
      };
      const addAssistantMessage=content=>{
        const chatBody=document.getElementById("chatBody");
        const msgBubble=document.createElement("div");
        msgBubble.classList.add("chat-message","assistant");
        msgBubble.innerHTML=formatMessage(content);
        chatBody.appendChild(msgBubble);
        chatHistory.push({type:"assistant",content});
        chatBody.scrollTop=chatBody.scrollHeight;
        msgBubble.querySelectorAll("pre code").forEach(block=>{hljs.highlightBlock(block);});
        return msgBubble;
      };
      const addUserMessage=content=>{
        const chatBody=document.getElementById("chatBody");
        const msgBubble=document.createElement("div");
        msgBubble.classList.add("chat-message","user");
        msgBubble.textContent=content;
        chatBody.appendChild(msgBubble);
        chatHistory.push({type:"user",content});
        chatBody.scrollTop=chatBody.scrollHeight;
      };
      const getAIResponse=userMessage=>{
        return fetch("https://api.aimlapi.com/v1/chat/completions",{
          method:"POST",
          headers:{"Content-Type":"application/json","Authorization":"Bearer "+getCurrentApiKey()},
          body:JSON.stringify({model:"mistralai/Mistral-7B-Instruct-v0.2",messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:userMessage}],temperature:0.7,max_tokens:285})
        })
        .then(response=>{
          if(response.status===429){rotateApiKey();return getAIResponse(userMessage);}
          return response.json();
        })
        .then(data=>{
          if(data.statusCode && (data.statusCode===429 || (data.message && data.message.toLowerCase().includes("limit")))){
            rotateApiKey();
            return getAIResponse(userMessage);
          }
          if(data && data.choices && data.choices.length>0 && data.choices[0].message && data.choices[0].message.content)
            return data.choices[0].message.content.trim();
          if(data && data.answer)return data.answer.trim();
          return "Maaf, tidak ada jawaban yang diterima.";
        })
        .catch(error=>{console.error("Error calling AI API:",error);return "Maaf, terjadi kesalahan pada layanan AI."});
      };
      const sendChatMessage=()=>{
        const chatInput=document.getElementById("chatInput");
        const message=chatInput.value.trim();
        if(!message)return;
        addUserMessage(message);
        chatInput.value="";
        if(isDeveloperQuery(message)){
          addAssistantMessage("Gua ini di buat sama Diz Flyze Developer, bro!");
          return;
        }
        const processingMsgElem=addAssistantMessage("Tunggu bre...");
        getAIResponse(message).then(answer=>{processingMsgElem.remove();addAssistantMessage(answer);});
      };
      const isDeveloperQuery=message=>{
        const lower=message.toLowerCase();
        return lower.includes("pengembang")||lower.includes("pembuat")||lower.includes("dibuat oleh")||lower.includes("di bikin");
      };
      const restartChat=()=>{
        const chatBody=document.getElementById("chatBody");
        chatBody.innerHTML="";
        chatHistory.forEach(msg=>{
          const msgBubble=document.createElement("div");
          msgBubble.classList.add("chat-message",msg.type);
          msgBubble.innerHTML=msg.content;
          chatBody.appendChild(msgBubble);
        });
        chatBody.scrollTop=chatBody.scrollHeight;
      };
      const backupChat=()=>{
        const data=JSON.stringify(chatHistory,null,2);
        const blob=new Blob([data],{type:"application/json"});
        const url=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=url;
        a.download="chat_backup_"+new Date().toISOString()+".json";
        a.click();
        URL.revokeObjectURL(url);
      };
      const restoreChat=()=>{document.getElementById("restoreFileInput").click();};
      const processImage=file=>{
        addAssistantMessage("Membaca gambar...");
        Tesseract.recognize(file,"ind",{logger:m=>console.log(m)})
        .then(({data:{text}})=>{
          const lines=text.split("\n").map(line=>line.trim()).filter(line=>line!=="");
          let question="",answer="";
          for(let line of lines){const matchQ=line.match(/^\d+\.\s*(.+)/); if(matchQ){question=matchQ[1]; break;}}
          for(let line of lines){const matchA=line.match(/^[aA]\.\s*(.+)/); if(matchA){answer="a. "+matchA[1]; break;}}
          let response=(question&&answer)?"<strong>Pertanyaan:</strong> "+question+"<br><strong>Jawaban:</strong> "+answer:"Tidak dapat mendeteksi pertanyaan atau jawaban dengan jelas.";
          addAssistantMessage(response);
        })
        .catch(err=>{console.error(err);addAssistantMessage("Terjadi kesalahan saat memproses gambar.");});
      };
      const processTextFile=file=>{
        const reader=new FileReader();
        reader.onload=evt=>{
          const text=evt.target.result;
          addUserMessage("File Text: "+text);
          const processingMsgElem=addAssistantMessage("Menganalisis file...");
          getAIResponse(text).then(answer=>{processingMsgElem.remove();addAssistantMessage("Diz AI : "+answer);});
        };
        reader.readAsText(file);
      };
      const auroraEffect=()=>{
        const canvas=document.getElementById("bgCanvas");
        const ctx=canvas.getContext("2d");
        canvas.width=window.innerWidth;
        canvas.height=window.innerHeight;
        let time=0;
        const draw=()=>{
          time+=0.005;
          const gradient=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
          const r1=Math.floor(128+127*Math.sin(time));
          const g1=Math.floor(128+127*Math.sin(time+2));
          const b1=Math.floor(128+127*Math.sin(time+4));
          gradient.addColorStop(0,`rgb(${r1},${g1},${b1})`);
          const r2=255-r1, g2=255-g1, b2=255-b1;
          gradient.addColorStop(1,`rgb(${r2},${g2},${b2})`);
          ctx.fillStyle=gradient;
          ctx.fillRect(0,0,canvas.width,canvas.height);
          requestAnimationFrame(draw);
        };
        draw();
      };
      const setupEventListeners=()=>{
        document.getElementById("chatSendBtn").addEventListener("click",sendChatMessage);
        document.getElementById("chatInput").addEventListener("keypress",e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendChatMessage();}});
        document.getElementById("chatPlusBtn").addEventListener("click",()=>{document.getElementById("uploadModal").style.display="block";});
        document.getElementById("closeUploadModal").addEventListener("click",()=>{document.getElementById("uploadModal").style.display="none";});
        document.getElementById("uploadImageBtn").addEventListener("click",()=>{document.getElementById("uploadModal").style.display="none";document.getElementById("chatFileInput").click();});
        document.getElementById("uploadFileBtn").addEventListener("click",()=>{document.getElementById("uploadModal").style.display="none";document.getElementById("chatFileTextInput").click();});
        document.getElementById("chatFileInput").addEventListener("change",e=>{const file=e.target.files[0]; if(file) processImage(file);});
        document.getElementById("chatFileTextInput").addEventListener("change",e=>{const file=e.target.files[0]; if(file) processTextFile(file);});
        document.getElementById("restoreFileInput").addEventListener("change",e=>{
          const file=e.target.files[0];
          if(!file)return;
          const reader=new FileReader();
          reader.onload=evt=>{try{chatHistory=JSON.parse(evt.target.result);restartChat();}catch(error){alert("Gagal memulihkan data backup.");}};
          reader.readAsText(file);
        });
      };
      const initApp=()=>{setupEventListeners(); addAssistantMessage("Hai, Saya AI Diz flyze asisten ganteng anda. Ada yang bisa saya bantu?");};
      document.addEventListener("DOMContentLoaded",()=>{auroraEffect(); setTimeout(()=>{document.getElementById("loadingOverlay").style.display="none"; initApp();},2000);});
      window.addEventListener("resize",()=>{const canvas=document.getElementById("bgCanvas"); canvas.width=window.innerWidth; canvas.height=window.innerHeight;});
    })();
  </script>
</body>
  </html>
